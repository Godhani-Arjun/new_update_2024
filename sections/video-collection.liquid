<div class="main-wrapper pd-top custom-collection-video">
  {% if section.settings.heading != blank %}
    <div class="collection-video-heading {% if section.settings.description == blank %} no-description{% endif %}">
      <h2 class="">{{ section.settings.heading }}</h2>
      {% if section.settings.description != blank %}
        {{ section.settings.description }}
      {% endif %}
    </div>
  {% endif %}
  <div
    class="content-over-media collection-video"
    style="{% render 'surface', text_color: section.settings.text_color %}"
  >
    {%- assign poster_image = section.settings.poster | default: section.settings.video.preview_image -%}

    {%- capture poster -%}
    {%- unless section.settings.autoplay -%}
      {%- if poster_image != blank -%}
        {{- poster_image | image_url: width: poster_image.width | image_tag: loading: 'lazy', sizes: '100vw', widths: '200,300,400,500,600,700,800,900,1000,1200,1400,1600,1800,2000,2200,2400,2600,2800,3000,3200' -}}
      {%- else -%}
        {{- 'lifestyle-1' | placeholder_svg_tag: 'h-full w-full placeholder' | replace: '<svg', '<svg preserveAspectRatio="xMinYMin slice"' -}}
      {%- endif -%}
    {%- endunless -%}
  {%- endcapture -%}

    {%- if section.settings.video -%}
      {%- if section.settings.mobile_video != blank -%}
        {%- assign poster_image = section.settings.poster | default: section.settings.mobile_video.preview_image -%}

        <video-media
          autoplay
          class="sm:hidden"
          style="--aspect-ratio: {{ section.settings.mobile_video.aspect_ratio }}"
        >
          {{-
            poster_image
            | image_url: width: poster_image.width
            | image_tag: loading: 'lazy', sizes: '100vw', widths: '200,300,400,500,600,700,800,900,1000,1200'
          -}}
          {{-
            section.settings.mobile_video
            | video_tag:
              class: 'object-cover sm:hidden',
              playsinline: true,
              muted: true,
              loop: true,
              preload: 'metadata',
              image_size: '400x'
          -}}
        </video-media>
      {%- endif -%}

      <video-media
        autoplay
        {% if section.settings.mobile_video != blank %}
          class="hidden sm:block"
        {% endif %}
        style="--aspect-ratio: {{ section.settings.video.aspect_ratio }}"
      >
        {{- poster -}}
        {{-
          section.settings.video
          | video_tag:
            class: 'object-cover',
            playsinline: true,
            muted: true,
            loop: true,
            preload: 'metadata',
            image_size: '400x'
        -}}
      </video-media>
    {%- else -%}
      <video-media host="{{ section.settings.external_video_url.type }}" class="pointer-events-none">
        {{- poster -}}

        <template>
          {%- if section.settings.external_video_url.type == 'youtube' -%}
            <iframe
              src="https://www.youtube.com/embed/{{ section.settings.external_video_url.id }}?playsinline=1&autoplay=1&controls=0&mute=1&loop=1&playlist={{ section.settings.external_video_url.id }}&enablejsapi=1&rel=0&modestbranding=1&origin={{ 'https://' | append: request.host | url_encode }}"
              allow="autoplay; encrypted-media"
              allowfullscreen="allowfullscreen"
            ></iframe>
          {%- elsif section.settings.external_video_url.type == 'vimeo' -%}
            <iframe
              src="https://player.vimeo.com/video/{{ section.settings.external_video_url.id }}?autopause=1&background=1&autoplay=1&loop=1&muted=1&transparent=0&responsive=1&portrait=0&title=0&byline=0&color={{ settings.text_color | remove_first: '#' }}"
              allow="autoplay; encrypted-media;"
              allowfullscreen="allowfullscreen"
            ></iframe>
          {%- endif -%}
        </template>
      </video-media>
    {%- endif -%}
  </div>
  <div class="collection-content">
    {% for block in section.blocks %}
      {% if block.type == 'collection' %}
        {% assign products = block.settings.product_list %}
        {% if products.count <= 3 or product.variants <= 3 %}
          <div class="product-list-container-coustom">
            {% assign products = block.settings.product_list %}
            {% assign product_count = products.count %}
            {% assign video_enable = false %}
            {% if block.settings.block_video %}
              {% assign video_enable = true %}
            {% endif %}
            {% for product in products %}
              {% if product_count == 1 %}
                {% for variant in product.variants %}
                  {% if video_enable %}
                    {% if forloop.index == 4 %}
                      {% break %}
                    {% endif %}
                  {% endif %}
                  <div class="product-item">
                    <div class="product-data">
                      {% if variant.metafields.custom.variant_banner %}
                        {%- assign image = variant.image -%}
                        {%- capture sizes -%}(max-width: 699px) 100vw, {% if block.settings.expand_collection %}100vw{% else %}(max-width: 1149px) {{ 100 | divided_by: section.settings.collections_per_row_desktop | at_least: 50 }}vw, {{ 100 | divided_by: section.settings.collections_per_row_desktop }}vw{% endif %}{%- endcapture -%}
                        {{-
                          image
                          | image_url: width: image.width
                          | image_tag:
                            sizes: sizes,
                            widths: '200,300,400,500,600,800,1000,1200,1400,1600,1800,2000,2200,2400',
                            class: '',
                            draggable: 'false'
                        -}}
                      {% else %}
                        {%- assign image = variant.image -%}
                        {%- capture sizes -%}(max-width: 699px) 100vw, {% if block.settings.expand_collection %}100vw{% else %}(max-width: 1149px) {{ 100 | divided_by: section.settings.collections_per_row_desktop | at_least: 50 }}vw, {{ 100 | divided_by: section.settings.collections_per_row_desktop }}vw{% endif %}{%- endcapture -%}
                        {{-
                          image
                          | image_url: width: image.width
                          | image_tag:
                            sizes: sizes,
                            widths: '200,300,400,500,600,800,1000,1200,1400,1600,1800,2000,2200,2400',
                            class: '',
                            draggable: 'false'
                        -}}
                      {% endif %}
                      <a href="{{ variant.url }}" class="button">Shop Now {% render 'anim-arrow' %}</a>
                    </div>
                    <a href="{{ variant.url }}">
                      <div class="product-detail">
                        <h3>{{ variant.title }}</h3>
                        <p>{{ variant.price | money }}</p>
                      </div>
                    </a>
                  </div>
                {% endfor %}
              {% else %}
                {% if video_enable %}
                  {% if forloop.index == 4 %}
                    {% break %}
                  {% endif %}
                {% endif %}
                <div class="product-item">
                  <div class="product-data">
                    {%- assign image = product.featured_image -%}
                    {%- capture sizes -%}(max-width: 699px) 100vw, {% if block.settings.expand_collection %}100vw{% else %}(max-width: 1149px) {{ 100 | divided_by: section.settings.collections_per_row_desktop | at_least: 50 }}vw, {{ 100 | divided_by: section.settings.collections_per_row_desktop }}vw{% endif %}{%- endcapture -%}
                    {{-
                      image
                      | image_url: width: image.width
                      | image_tag:
                        sizes: sizes,
                        widths: '200,300,400,500,600,800,1000,1200,1400,1600,1800,2000,2200,2400',
                        class: '',
                        draggable: 'false'
                    -}}
                    <a href="{{ product.url }}" class="button">Shop Now {% render 'anim-arrow' %}</a>
                  </div>
                  <a href="{{ product.url }}">
                    <div class="product-detail">
                      <h3>{{ product.title }}</h3>
                      <p>{{ product.price | money }}</p>
                    </div>
                  </a>
                </div>
              {% endif %}
            {% endfor %}
            {% if block.settings.block_video != blank %}
              <div class="product-item video-item">
                <div class="product-data">
                  {{-
                    block.settings.block_video
                    | video_tag:
                      class: 'object-cover',
                      playsinline: true,
                      muted: true,
                      loop: true,
                      preload: 'metadata',
                      autoplay: true
                  -}}
                </div>
                {% if block.settings.tile_heading != blank %}
                  <div class="product-detail">
                    <h3>
                      <a href="{{block.settings.collection_url}}">{{ block.settings.tile_heading }}</a>
                    </h3>
                  </div>
                {% endif %}
              </div>
            {% endif %}
          </div>
          {%- assign collection_url = section.settings.view_all_collection -%}
          {%- if collection_url != blank -%}
            <div class="view_all_product">
              <a href="{{ collection_url }}" class="button button--outline">{{ section.settings.button_text }}</a>
            </div>
          {% endif %}
        {% else %}
          <div class="product-list-container">
            {% assign products = block.settings.product_list %}
            {% assign product_count = products.count %}
            {% assign video_enable = false %}
            {% if block.settings.block_video %}
              {% assign video_enable = true %}
            {% endif %}
            {% for product in products %}
              {% if product_count == 1 %}
                {% for variant in product.variants %}
                  {% if video_enable %}
                    {% if forloop.index == 4 %}
                      {% break %}
                    {% endif %}
                  {% endif %}
                  <div class="product-item">
                    <div class="product-data">
                      {% if variant.metafields.custom.variant_banner %}
                        {% comment %}
                          <img
                            src="{{ variant.metafields.custom.variant_banner | img_url: 'large' }}"
                            alt="{{ variant.title }}"
                            height=""
                            width=""
                          >
                        {% endcomment %}
                        {%- assign image = variant.metafields.custom.variant_banner -%}
                        {%- capture sizes -%}(max-width: 699px) 100vw, {% if block.settings.expand_collection %}100vw{% else %}(max-width: 1149px) {{ 100 | divided_by: section.settings.collections_per_row_desktop | at_least: 50 }}vw, {{ 100 | divided_by: section.settings.collections_per_row_desktop }}vw{% endif %}{%- endcapture -%}
                        {{-
                          image
                          | image_url: width: image.width
                          | image_tag:
                            sizes: sizes,
                            widths: '200,300,400,500,600,800,1000,1200,1400,1600,1800,2000,2200,2400',
                            class: '',
                            draggable: 'false'
                        -}}
                      {% else %}
                        {% comment %} <img src="{{ variant.image | img_url: 'large' }}" alt="{{ variant.title }}" height="" width=""> {% endcomment %}
                        {%- assign image = variant.image -%}
                        {%- capture sizes -%}(max-width: 699px) 100vw, {% if block.settings.expand_collection %}100vw{% else %}(max-width: 1149px) {{ 100 | divided_by: section.settings.collections_per_row_desktop | at_least: 50 }}vw, {{ 100 | divided_by: section.settings.collections_per_row_desktop }}vw{% endif %}{%- endcapture -%}
                        {{-
                          image
                          | image_url: width: image.width
                          | image_tag:
                            sizes: sizes,
                            widths: '200,300,400,500,600,800,1000,1200,1400,1600,1800,2000,2200,2400',
                            class: '',
                            draggable: 'false'
                        -}}
                      {% endif %}
                      <a href="{{ variant.url }}" class="button">Shop Now {% render 'anim-arrow' %}</a>
                    </div>
                    <a href="{{ product.url }}">
                      <div class="product-detail">
                        <h3>{{ variant.title }}</h3>
                        <p>{{ variant.price | money }}</p>
                      </div>
                    </a>
                  </div>
                {% endfor %}
              {% else %}
                {% if video_enable %}
                  {% if forloop.index == 4 %}
                    {% break %}
                  {% endif %}
                {% endif %}
                <div class="product-item">
                  <div class="product-data">
                    {% comment %}
                      <img
                        src="{{ product.featured_image | img_url: 'large' }}"
                        alt="{{ product.title }}"
                        height=""
                        width=""
                      >
                    {% endcomment %}
                    {%- assign image = product.featured_image -%}
                    {%- capture sizes -%}(max-width: 699px) 100vw, {% if block.settings.expand_collection %}100vw{% else %}(max-width: 1149px) {{ 100 | divided_by: section.settings.collections_per_row_desktop | at_least: 50 }}vw, {{ 100 | divided_by: section.settings.collections_per_row_desktop }}vw{% endif %}{%- endcapture -%}
                    {{-
                      image
                      | image_url: width: image.width
                      | image_tag:
                        sizes: sizes,
                        widths: '200,300,400,500,600,800,1000,1200,1400,1600,1800,2000,2200,2400',
                        class: '',
                        draggable: 'false'
                    -}}
                    <a href="{{ product.url }}" class="button">Shop Now {% render 'anim-arrow' %}</a>
                  </div>
                  <a href="{{ product.url }}">
                    <div class="product-detail">
                      <h3>{{ product.title }}</h3>
                      <p>{{ product.price | money }}</p>
                    </div>
                  </a>
                </div>
              {% endif %}
            {% endfor %}
            {% if block.settings.block_video != blank %}
              <div class="product-item video-item">
                <div class="product-data">
                  {{-
                    block.settings.block_video
                    | video_tag:
                      class: 'object-cover',
                      playsinline: true,
                      muted: true,
                      loop: true,
                      preload: 'metadata',
                      autoplay: true
                  -}}
                </div>
                {% if block.settings.tile_heading != blank %}
                  <div class="product-detail">
                    <h3>
                      <a href="{{block.settings.collection_url}}">{{ block.settings.tile_heading }}</a>
                    </h3>
                  </div>
                {% endif %}
              </div>
            {% endif %}
          </div>
          {%- assign collection_url = section.settings.view_all_collection -%}
          {%- if collection_url != blank -%}
            <div class="view_all_product">
              <a href="{{ collection_url }}" class="button button--outline">{{ section.settings.button_text }}</a>
            </div>
          {% endif %}
        {% endif %}
      {% endif %}
    {% endfor %}
  </div>
</div>
<style>
  .collection-content {
    position: relative;
    background: #fff;
  }
  .content-over-media.collection-video {
    position: sticky;
    top: calc(var(--announcement-bar-height) + var(--header-height)) !important;
    margin-bottom: 1px;
  }
  .collection-video-heading {
    max-width: 964px;
    margin: auto;
    text-align: center;
  }
  .collection-video-heading {
    padding-bottom: 30px;
  }
  .collection-video-heading h2 {
    font-family: 'Futura Medium BT';
    font-weight: 400;
    color: #000;
  }
  .product-list-container {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 30px;
  }
  .product-list-container-coustom {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 30px;
  }

  .collection-video-heading p {
    font-family: 'Roboto', sans-serif;
    max-width: 753px;
    margin: auto;
    color: #6c6c6c;
    font-size: 16px;
    font-weight: 400;
    line-height: 26.08px;
    letter-spacing: 1px !important;
    padding-top: 10px;
  }
  .collection-content {
    max-width: 100%;
    margin: auto;
    padding: 50px 57px 0;
  }
  .product-item img {
    width: 100%;
    height: 100%;
    min-height: inherit;
    object-fit: cover;
  }

  .product-detail {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 20px;
  }
  .product-data {
    position: relative;
    overflow: hidden;
    min-height: 496px;
    max-height: 496px;
  }
  .product-data a.button {
    position: absolute;
    bottom: 0;
    width: 100%;
    background: #000;
    color: #fff;
    border: 0;
    border-radius: 0;
    margin: auto;
    max-width: 85%;
    left: 0;
    right: 0;
    bottom: 30px;
    z-index: 3;
    opacity: 0;
    font-size: 18px;
    line-height: 23px;
    letter-spacing: 1px;
    padding: 16.5px 28px;
    transition: opacity 0.5s ease-in;
    text-transform: uppercase;
    gap: 0;
    font-weight: 700;
  }
  .product-data::after {
    content: '';
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 0%;
    background-color: rgba(0, 0, 0, 0.3);
    z-index: 2;
    transition: height 0.5s ease;
  }

  @media (max-width: 699px) {
    .product-data a.button,
    .product-data::after,
    .product-data a.button svg {
      opacity: 0 !important;
    }
    .product-data a.button {
      height: 100%;
    }
  }

  .product-data:hover a.button {
    opacity: 1;
  }
  .product-data a.button svg {
    transform: translateX(0);
    opacity: 0;
    transition: all 0.5s ease;
  }
  .product-data:hover a.button svg {
    transform: translateX(15px);
    opacity: 1;
    transition: all 0.1s ease;
  }
  .product-data:hover a.button svg {
    opacity: 1;
  }

  .product-data:hover::after {
    height: 100%;
  }
  .product-detail h3 {
    font-family: 'Roboto', sans-serif;
    font-weight: 400;
    line-height: 23.4px !important;
    letter-spacing: 0.4px !important;
  }
  .product-detail h3 a {
    letter-spacing: 0.4px !important;
  }
  .product-detail p {
    font-family: 'Roboto', sans-serif;
    color: #222;
    font-size: 18px;
    line-height: 28.8px;
  }
  .video-item video {
    position: absolute;
    height: 100%;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    margin: auto;
    object-fit: cover;
    width: 100%;
  }
  .video-item .product-data::after {
    display: none;
  }

  .custom-collection-video .view_all_product {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 30px 0 0 0;
  }

  .custom-collection-video .button {
    color: #000;
    --hover-gradient: linear-gradient(rgb(0 0 0), rgb(0 0 0));
    border-radius: unset;
  }

  @media (min-width: 1920px) {
    .product-list-container {
      max-width: 1920px;
      margin: 0 auto;
    }
  }

  @media (max-width: 1599px) {
    .product-list-container {
      gap: 15px;
    }
  }
  @media (max-width: 1365px) {
    .product-data {
      max-height: 350px;
      min-height: 350px;
    }
  }
  @media (max-width: 1199px) {
    .product-data {
      max-height: 250px;
      min-height: 250px;
    }
  }
  @media (max-width: 1023px) {
    .collection-video-heading {
      padding: 0 21px 10px;
    }
    .product-list-container {
      gap: 20px;
      overflow-x: auto;
      grid-template-columns: repeat(4, 400px);
    }
    .product-list-container-coustom {
      gap: 20px;
      overflow-x: auto;
      grid-template-columns: repeat(3, 400px);
    }
    .product-data {
      max-height: 496px;
      min-height: 496px;
    }
    .collection-video-heading h2 {
      font-size: 24px !important;
      line-height: 31px !important;
    }
    .collection-video-heading.no-description {
      padding-bottom: 20px;
    }
  }
  @media (max-width: 989px) {
    .product-list-container {
      grid-template-columns: repeat(4, 300px);
    }
    .product-list-container-coustom {
      grid-template-columns: repeat(3, 300px);
    }
    .product-data {
      max-height: 350px;
      min-height: 350px;
    }
    .collection-content {
      padding-left: 20px;
      padding-right: 0;
    }
  }
  @media (max-width: 749px) {
    .product-detail {
      flex-direction: column;
      margin-top: 10px;
      align-items: flex-start;
    }
    .product-detail p {
      font-weight: 500;
    }
    .collection-content {
      padding-top: 20px;
    }
    .custom-collection-video .button {
      color: #fff !important;
      background-color: #000;
    }
  }
  @media (max-width: 480px) {
    .product-list-container {
      grid-template-columns: repeat(4, 280px);
    }
    .product-list-container-coustom {
      grid-template-columns: repeat(3, 280px);
    }
    .product-data {
      max-height: 250px !important;
      min-height: 250px !important;
    }
    .product-detail h3 {
      font-size: 16px;
      line-height: 20.8px;
      letter-spacing: 0.4px;
      margin-bottom: 3px;
    }
    .collection-video-heading p {
      font-size: 12px;
      line-height: 19.2px;
    }
  }
</style>

{% schema %}
{
  "name": "Collection and Video",
  "tag": "section",
  "disabled_on": {
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
      "type": "paragraph",
      "content": "t:sections.video.info"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description"
    },
    {
      "type": "video",
      "id": "video",
      "label": "t:global.video.video",
      "info": "t:global.video.video_info"
    },
    {
      "type": "video_url",
      "id": "external_video_url",
      "accept": ["vimeo", "youtube"],
      "label": "t:global.video.video_url",
      "default": "https://www.youtube.com/watch?v=_9VUPq3SxOc"
    },
    {
      "type": "image_picker",
      "id": "poster",
      "label": "t:sections.video.poster_image",
      "info": "t:sections.video.poster_image_info"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text"
    },
    {
      "type": "url",
      "id": "view_all_collection",
      "label": "select collection to show more product when button click"
    }
  ],
  "blocks": [
    {
      "type": "collection",
      "name": "Product list",
      "limit": 1,
      "settings": [
        {
          "id": "product_list",
          "type": "product_list",
          "label": "Select Product",
          "limit": 4
        },
        {
          "type": "video",
          "id": "block_video",
          "label": "t:global.video.video",
          "info": "t:global.video.video_info"
        },
        {
          "type": "text",
          "id": "tile_heading",
          "label": "Enter Tile Heading"
        },
        {
          "type": "url",
          "id": "collection_url",
          "label": "Select URL"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Collection and Video"
    }
  ]
}
{% endschema %}
